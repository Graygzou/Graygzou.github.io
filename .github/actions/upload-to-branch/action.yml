name: upload-to-branch
author: Gr√©goire Boiron (Graygzou)
description: Create a branch, push changes to it and print link to the possible PR
inputs:
  target-branch:
    description: "The target branch to push to"
    required: false
    default: "develop"
  user-name:
    description: "name of the user pushing to github"
    required: true
    default: ""
  user-email:
    description: "email of the user pushing to github"
    required: true
    default: ""
runs:
  using: "composite"
  steps:
    - name: Config git
      run: |
        git config user.email ${{ inputs.user-email }}
        git config user.name ${{ inputs.user-name }}
        git config pull.ff only
      shell: bash

    - name: Checkout the branch
      id: branch-checkout
      run: git checkout -b ${{ inputs.target-branch }}
      shell: bash

    - name: Add changement to branch
      run: |
        git add .
        git commit -m "[ignore] Upload files generate by the job #$GITHUB_RUN_ID $GITHUB_ACTION"
        git push origin HEAD:${{ inputs.target-branch }}
      shell: bash

    - name: Create PR link if not develop
      run: |
        if [ ${{ inputs.target-branch }} != 'develop' ] then
          git request-pull $GITHUB_SHA "$GITHUB_SERVER_URL/$GITHUB_REPOSITORY" ${{ inputs.target-branch }}
        fi
      shell: bash

branding:
  icon: cpu
  color: green







